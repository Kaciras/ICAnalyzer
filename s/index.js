"use strict";(self.webpackChunkic_analyzer=self.webpackChunkic_analyzer||[]).push([[57],{3266:(e,t,n)=>{var a,l,i,s={};n.r(s),n.d(s,{defaultOptions:()=>ey,encode:()=>eA,extension:()=>eN,mimeType:()=>eS,name:()=>eC,templates:()=>ek});var r={};n.r(r),n.d(r,{defaultOptions:()=>eE,encode:()=>eM,extension:()=>eO,mimeType:()=>e_,name:()=>eI,templates:()=>eV});var o={};n.r(o),n.d(o,{defaultOptions:()=>eP,encode:()=>ez,extension:()=>eF,mimeType:()=>eD,name:()=>eR,templates:()=>eq});var c={};n.r(c),n.d(c,{defaultOptions:()=>eQ,encode:()=>eH,extension:()=>eY,mimeType:()=>eG,name:()=>eU,templates:()=>eW});var u={};n.r(u),n.d(u,{defaultOptions:()=>eX,encode:()=>e4,extension:()=>e1,mimeType:()=>e0,name:()=>e$,templates:()=>e2});var d=n(6070),m=n(9576),h=n(1471),p=n(3917);let f=JSON.parse('{"UU":"ic-analyzer","rE":"0.2.0"}');var x=n(758),g=n(3015),b=n(1336),w=n(3526);let j={container:"FgknC",disabled:"G1q09",input:"XUHPc",mark:"KpkgA",label:"BwVxe"};function v(e){let{className:t,type:n,Icon:a,IconChecked:l,name:i,value:s,checked:r,disabled:o,onClick:c,onSelected:u=g.lQ,onChange:m=g.lQ,onCheckedChange:h=g.lQ,children:p}=e,f=(0,w.A)(j.container,t,o&&j.disabled);return(0,d.jsxs)("label",{className:f,onClick:c,children:[(0,d.jsx)("input",{type:n,className:j.input,name:i,value:s,disabled:o,checked:r,onChange:function(e){let{checked:t}=e.currentTarget;t&&u(s),m(e),h(t)}}),(0,d.jsx)(r?l:a,{className:j.mark}),p&&(0,d.jsx)("span",{className:j.label,children:p})]})}let y={container:"aVfJx",disabled:"l3iqk",thumbRegion:"P2PLz",thumb:"rdlcx",input:"Niqmg"};function C(e){let{className:t,name:n,value:a,min:l,max:i,step:s,disabled:r,onClick:o,onChange:c=g.lQ,onValueChange:u=g.lQ}=e,m=(a-l)/(i-l),h={"--value-percent":`${100*m}%`},p=(0,w.A)(y.container,t,r&&y.disabled);return(0,d.jsxs)("div",{className:p,style:h,children:[(0,d.jsx)("input",{type:"range",className:y.input,name:n,disabled:r,value:a,min:l,max:i,step:s,onClick:o,onChange:function(e){c(e),u(e.currentTarget.valueAsNumber)}}),(0,d.jsx)("div",{className:y.thumbRegion,children:(0,d.jsx)("div",{className:y.thumb})})]})}let S={base:"IG6_k",text:"qZ052 IG6_k",active:"fGZHk",button:"sNw0y IG6_k",outline:"l9Gvg sNw0y IG6_k",busy:"Jt9Fm"};function N(e){let{type:t="button",href:n,active:a,className:l,children:i,...s}=e;return s.className=(0,w.A)(S[t],l,a&&S.active),s.type=n?void 0:"button",(0,d.jsx)(n?"a":"button",{...s,href:n,children:i})}function k(e){let{file:t,children:n,...a}=e,l=(0,x.useRef)("");return(0,x.useEffect)(()=>()=>URL.revokeObjectURL(l.current),[]),(0,d.jsx)(N,{...a,onClick:function(){URL.revokeObjectURL(l.current);let e=URL.createObjectURL(t);l.current=e;let n=document.createElement("a");n.href=e,n.download=t.name,n.click()},children:n})}var A=n(1317);let E={container:"T36jt",input:"oeBOT no-spinner",button:"toS6H"},I=x.memo(function(e){let{inputId:t,title:n,name:a,className:l,disabled:i,minMaxButton:s,value:r,min:o=0,max:c=Number.MAX_SAFE_INTEGER,step:u=1,increment:m=u,onChange:h=g.lQ,onValueChange:p=g.lQ}=e,f=(0,x.useRef)(null);function b(e){let t=f.current;t.valueAsNumber=e,t.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}function j(e,t){if(0!==e.button)return;let n=0,a=Math.pow(10,function(e){let t=e.toString(),n=t.indexOf(".")+1;return n||t.length-n}(u));function l(e){return e+=t,Math.round((e=Math.min(Math.max(e,o),c))*a)/a}let i=l(f.current.valueAsNumber);b(i),n=window.setTimeout(()=>(function e(t){let a=l(t);b(a),n=window.setTimeout(()=>e(a),50)})(i),400),document.addEventListener("mouseup",function e(){clearTimeout(n),document.removeEventListener("mouseup",e)})}return(0,d.jsxs)("div",{title:n,className:(0,w.A)(E.container,l),children:[s&&(0,d.jsx)("button",{title:"Min",type:"button",className:E.button,tabIndex:-1,disabled:i,onClick:()=>b(o),children:(0,d.jsx)(A.CO0,{})}),(0,d.jsx)("button",{title:"Decrease",type:"button",className:E.button,tabIndex:-1,disabled:i,onPointerDown:e=>j(e,-m),children:(0,d.jsx)(A.Xhv,{shapeRendering:"crispEdges"})}),(0,d.jsx)("input",{type:"number",id:t,ref:f,className:E.input,disabled:i,name:a,min:o,max:c,step:u,value:r,onChange:function(e){h(e),p(e.currentTarget.valueAsNumber)}}),(0,d.jsx)("button",{title:"Increase",type:"button",className:E.button,tabIndex:-1,disabled:i,onPointerDown:e=>j(e,m),children:(0,d.jsx)(A.r2j,{shapeRendering:"crispEdges"})}),s&&(0,d.jsx)("button",{title:"Max",type:"button",className:E.button,tabIndex:-1,disabled:i,onClick:()=>b(c),children:(0,d.jsx)(A.BM,{})})]})});var _=n(8143);let O={dimmer:"XhhBO",dialog:"eGPu3"};function V(e){let{className:t,name:n,onClose:a,children:l}=e;function i(e){"Escape"===e.key&&(a?.(),e.stopImmediatePropagation())}(0,x.useEffect)(function(){return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[a]);let s=(0,d.jsx)("div",{className:O.dimmer,children:(0,d.jsx)("div",{role:"dialog","aria-label":n,className:(0,w.A)(O.dialog,t),children:l})});return(0,_.createPortal)(s,document.body)}let M=e=>e.stopPropagation();function P(e,t){if(null===t)return;let n=t.getContext("2d");if(n)n.putImageData(e,0,0);else throw Error("Canvas not initialized")}function R(e){return function(t){if(0!==t.button)return;let{nativeEvent:n}=t;function a(t){e(t,n)}t.preventDefault(),document.addEventListener("pointerup",function e(t){t.preventDefault(),document.removeEventListener("pointerup",e),document.removeEventListener("pointermove",a)}),document.addEventListener("pointermove",a)}}function D(e){let{state:t,className:n,children:a,onChange:l}=e,i=R((e,n)=>{let{pageX:a,pageY:i}=e,{pageX:s,pageY:r}=n,o=t.x+a-s,c=t.y+i-r;l({scale:t.scale,x:o,y:c})});return(0,d.jsx)("div",{style:{touchAction:"none"},className:n,onWheel:function(e){let{ctrlKey:n,deltaMode:a,clientX:i,clientY:s}=e,{deltaY:r}=e;e.preventDefault(),1===a&&(r*=15);let o=1-r/(n?100:300),c=e.currentTarget.firstElementChild.getBoundingClientRect(),u=(c.left+c.width/2-i)*(o-1),d=(c.top+c.height/2-s)*(o-1);l({x:t.x+u,y:t.y+d,scale:t.scale*o})},onPointerDown:i,children:a})}var F=n(9998);let L={container:"nY79E",select:"epIiv",icon:"DyuSV"};function T(e){let{onChange:t=g.lQ,onValueChange:n,...a}=e;return(0,d.jsxs)("div",{className:L.container,children:[(0,d.jsx)("select",{...a,className:L.select,onChange:function(e){t(e),n(e.currentTarget.value)}}),(0,d.jsx)(F.lLv,{className:L.icon})]})}let q={container:"nHZES",checked:"lQRCF",disabled:"dHMC5",input:"NEV5M"};function z(e){let{className:t,name:n,value:a,checked:l,disabled:i,onClick:s,onChange:r=g.lQ,onCheckedChange:o=g.lQ,onSelected:c=g.lQ}=e,u=(0,w.A)(q.container,t,i&&q.disabled,l&&q.checked);return(0,d.jsx)("label",{className:u,children:(0,d.jsx)("input",{type:"checkbox",className:q.input,disabled:i,checked:l,name:n,value:a,onClick:s,onChange:function(e){let{checked:t}=e.currentTarget;t&&c(a),r(e),o(t)}})})}let B={fileDropBox:"wAUIr",dragging:"xeCOC",text:"F7KIv",icon:"xYmpo F7KIv",fileInput:"IvOsd"},Q={en:{ICAnalyzerIntro:"Online Image Compression & Analysis Tool",SourceCode:"Source Code",Back:"Back",SelectFile:"Select a file",ShowMetrics:"Show metrics",DownloadOutput:"Download output image",LockYAxis:"Lock Y axis",DownloadSVG:"Download SVG image",DownloadFullAxis:"Download with full Axis",MeasureOptions:"Measure Options",Remove:"Remove",AddAtLeast2Images:"Add at least two images",FirstIsTheOriginal:"The first will be the original",DndToReorder:"Use drag & drop to change the order",AnalysisConfig:"Analysis config",EncodeTimeSecond:"Encode Time (s)",Codec:"Codec",Preview:"Preview",FileName:"File name",FileType:"File type",Resolution:"Resolution",RawSize:"Raw size",FileSizeAndRatio:"File size (Ratio %)",SplitView:"Split",InputView:"Input",OutputView:"Output",DiffView:"Diff",HeatMapView:"HeatMap",RequireButteraugli:"Require enable butteraugli",PickColor:"Pick color",Brightness:"Brightness",ThreadCount:"Thread count (more threads require more RAM)",MeasureEncodeTime:"Encode time (Not very accurate)",MeasurePSNR:"Peak signal-to-noise ratio (PSNR)",MeasureSSIM:"Structural similarity index measure (SSIM)",Encoding:"Encoding",ElapsedTime:"Elapsed time",Cancel:"Cancel",Error:"Error",OrTryOneOfThese:"Or try one of these",DropAFile:"Drag & drop",OrSelectFile:"Or select a file",ZoomScale:"Zoom scale",ResetPinchZoom:"Reset pinch zoom",Information:"Information",Encoders:"Encoders",Analysis:"Analysis",Start:"Start"},zh:{ICAnalyzerIntro:"在线的图片转码与分析工具",SourceCode:"开源仓库",Back:"返回",SelectFile:"选择文件",ShowMetrics:"显示指标",DownloadOutput:"下载当前的输出图片",LockYAxis:"锁定 Y 轴",DownloadSVG:"保存为 SVG 图",DownloadFullAxis:"保存并显示所有 Y 轴",MeasureOptions:"测量选项",Remove:"移除",AddAtLeast2Images:"选择至少两张图片",FirstIsTheOriginal:"第一个将被视为原图",DndToReorder:"拖拽可以调整顺序",AnalysisConfig:"分析设置",EncodeTimeSecond:"转换用时 (秒)",Codec:"编码",Preview:"预览",FileName:"文件名",FileType:"文件类型",Resolution:"分辨率",RawSize:"原始大小",FileSizeAndRatio:"大小（压缩率）",SplitView:"分割",InputView:"原图",OutputView:"输出",DiffView:"差分",HeatMapView:"HeatMap",RequireButteraugli:"需要启用 butteraugli",PickColor:"取色",Brightness:"亮度",ThreadCount:"线程数（增加将占用更多内存）",MeasureEncodeTime:"转换时间（不是太准）",MeasurePSNR:"峰值信噪比 (PSNR)",MeasureSSIM:"结构相似度 (SSIM)",Encoding:"转码中",ElapsedTime:"已经过时间",Cancel:"取消",Error:"错误",OrTryOneOfThese:"或者尝试以下的",DropAFile:"拖放文件",OrSelectFile:"或者点击选择",ZoomScale:"缩放率",ResetPinchZoom:"重置位置和缩放",Information:"信息",Encoders:"转码器",Analysis:"分析",Start:"开始"}},U=Q[localStorage.getItem("lang")??navigator.language.split("-",2)[0]]??Q.en;function G(e){let{className:t,accept:n="*/*",multiple:a,onSelectStart:l=g.lQ,onChange:i,onError:s}=e,r=function(){let[e,t]=(0,x.useState)(!1),n=(0,x.useRef)(0);return{isInArea:e,enter:function(){t(++n.current>0)},leave:function(){t(--n.current>0)},reset:function(){n.current=0,t(!1)}}}(),o=(0,x.useRef)(!1),c=(0,w.A)(B.fileDropBox,t,{[B.dragging]:r.isInArea});return(0,d.jsxs)("label",{className:c,onDragEnter:function(){r.enter(),o.current||(o.current=!0,l(),document.addEventListener("dragend",function e(){document.removeEventListener("dragend",e),o.current=!1}))},onDragOver:e=>e.preventDefault(),onDrop:function(e){e.preventDefault(),r.reset();let{items:t}=e.dataTransfer,n=Array.from(t).map(e=>e.getAsFile()).filter(Boolean);n.length===t.length?i(n):s(Error("Non-file item in the dropped list"))},onDragLeave:r.leave,children:[(0,d.jsxs)("span",{children:[(0,d.jsx)(A.J2d,{className:B.icon}),(0,d.jsx)("span",{className:B.text,children:U.DropAFile})]}),(0,d.jsx)("span",{className:B.text,children:U.OrSelectFile}),(0,d.jsx)("input",{className:B.fileInput,name:"file",type:"file",accept:n,multiple:a,onClick:l,onChange:function(e){let{files:t}=e.currentTarget;t?.length&&i(Array.from(t))}})]})}let Y={container:"CwtYo",color:"l2eAF"};function J(e,t,n){let{width:a,data:l}=e,i=(t+n*a)*4;return l.slice(i,i+4)}function W(e){let{name:t,value:n}=e,a=n.reduce((e,t)=>{var n;return e+((n=t.toString(16)).length<2?"0"+n:n)},"#").toUpperCase(),l={"--color":a.substring(0,7)};return(0,d.jsxs)("div",{className:Y.color,style:l,children:[t,": ",a]})}function H(e){let{style:t,x:n,y:a,imageA:l,imageB:i}=e,s=J(l,n,a),r=J(i,n,a),o=s.map((e,t)=>Math.abs(e-r[t]));return(0,d.jsxs)("div",{className:Y.container,style:t,children:[(0,d.jsxs)("div",{children:["x: ",n,", y: ",a]}),(0,d.jsx)(W,{name:"Origin",value:s}),(0,d.jsx)(W,{name:"Output",value:r}),(0,d.jsx)(W,{name:"Diff",value:o})]})}function K(e){let{className:t,index:n,onChange:a,children:l}=e,i=(0,x.useRef)([]),s=x.Children.map(l,(e,t)=>{if(!(0,x.isValidElement)(e))return e;let{onClick:l=g.lQ,ref:s=g.lQ}=e.props,r=t===n;return(0,x.cloneElement)(e,{"aria-selected":r,role:"tab",tabIndex:r?0:-1,ref:function(e){"object"!=typeof s?s():s&&(s.current=e),i.current[t]=e},onClick:function(e){a(t),l(e)}})}),r=s.length;return i.current.length=r,(0,d.jsx)("div",{className:t,role:"tablist",onKeyDown:function(e){let t=n;switch(e.key){case"Home":t=0;break;case"End":t=r-1;break;case"ArrowLeft":case"ArrowUp":t-=1;break;case"ArrowRight":case"ArrowDown":t+=1;break;default:return}e.preventDefault(),a(t=(t+r)%r),i.current[t].focus()},children:s})}function Z(e){let{index:t,children:n}=e,a=x.Children.map(n,(e,n)=>(0,x.isValidElement)(e)?(0,x.cloneElement)(e,{isActive:n===t}):e);return(0,d.jsx)(x.Fragment,{children:a})}function X(e){let{className:t,name:n,value:a,disabled:l,onChange:i,children:s}=e,r=x.Children.map(s,e=>{if(!(0,x.isValidElement)(e))return e;let t=e.props.value;return(0,x.cloneElement)(e,{checked:a===t,name:n,disabled:l,onSelected:i})});return(0,d.jsx)("div",{className:t,children:r})}let $={zoomInput:"YUkjD uy3Os",button:"hGGMO"},ee=x.memo(function(e){let{defaultValue:t,value:n,onChange:a,...l}=e;return(0,d.jsxs)("div",{...l,children:[(0,d.jsx)(I,{title:U.ZoomScale,min:25,step:1,increment:25,className:$.zoomInput,value:Math.round(100*n.scale),onValueChange:function(e){a(t=>({...t,scale:e/100}))}}),t&&(0,d.jsx)(N,{title:U.ResetPinchZoom,type:"text",className:$.button,onClick:()=>a(t),children:(0,d.jsx)(F.h_g,{})})]})}),et=(0,x.memo)(e=>v({...e,type:"checkbox",Icon:b.Dnq,IconChecked:b.lEn})),en=(0,x.memo)(e=>v({...e,type:"radio",Icon:b.H4D,IconChecked:b.UoP}));et.displayName="CheckBox",en.displayName="RadioBox";let ea={control:"oD1zK"};class el{id;label;data;constructor(e){this.data=e,this.id=e.id,this.label=e.label,this.Input=this.Input.bind(this)}createState(){return[!1,!0]}indexOf(e){return e?1:0}Input(e){let{value:t,onChange:n}=e,{label:a}=this.data;return(0,d.jsxs)("div",{className:ea.control,children:[a,(0,d.jsx)(z,{checked:t,onCheckedChange:n,onClick:e=>e.stopPropagation()})]})}}let ei={label:"iXJnm",container:"keW4D"};class es{data;constructor(e){this.data=e,this.OptionField=this.OptionField.bind(this)}get id(){return this.data.id}createControl(){return new el(this.data)}createState(){return[!!this.data.defaultValue,void 0]}populate(e,t){t[this.data.id]=e}OptionField(e){let{id:t,label:n}=this.data,{isVariable:a,value:l,onValueChange:i}=e;return(0,d.jsxs)("div",{className:ei.container,children:[(0,d.jsx)("span",{className:ei.label,children:n}),a?(0,d.jsx)("strong",{children:"OFF & ON"}):(0,d.jsx)(z,{name:t,checked:l,onCheckedChange:i})]})}}let er={item:"we0Sh"};class eo{id;label;data;constructor(e){this.data=e,this.id=e.id,this.label=e.label,this.Input=this.Input.bind(this)}createState(){return this.data.names}indexOf(e){return this.data.names.indexOf(e)}Input(e){let{id:t,label:n,names:a}=this.data,{value:l,onChange:i}=e,s=a.map(e=>(0,d.jsx)(en,{className:er.item,value:e,children:e},e));return(0,d.jsxs)(d.Fragment,{children:[n,(0,d.jsx)(X,{value:l,name:t,onChange:i,children:s})]})}}let ec={item:"CSeuH",label:"QbADJ"};class eu{data;constructor(e){this.data=e,this.OptionField=this.OptionField.bind(this)}get id(){return this.data.id}createControl(e){let{id:t,label:n}=this.data;return new eo({id:t,label:n,names:e})}createState(){let{defaultValue:e}=this.data;return[e,[e]]}populate(e,t){t[this.data.id]=e}OptionField(e){let t;let{id:n,label:a,enumObject:l}=this.data,{isVariable:i,value:s,range:r,onValueChange:o,onRangeChange:c}=e;function u(e){let{checked:t,name:n}=e.currentTarget,a=[...r];t?a.push(n):a=r.filter(e=>e!==n),a.length>0&&c(a)}function m(e){o(e.currentTarget.value)}return t=i?Object.keys(l).map(e=>(0,d.jsx)(et,{className:ec.item,name:e,checked:r.includes(e),onChange:u,children:e},e)):Object.keys(l).map(e=>(0,d.jsx)(en,{className:ec.item,name:n,value:e,checked:s===e,onChange:m,children:e},e)),(0,d.jsxs)("div",{className:ec.fieldset,children:[(0,d.jsx)("span",{className:ec.label,children:a}),(0,d.jsx)("div",{className:ec.body,children:t})]})}}let ed={header:"CO7Uq",input:"N2Ak0 no-spinner"},em=x.memo(function(e){let{name:t,className:n,disabled:a,value:l,min:i,max:s,step:r,onChange:o,children:c}=e,[u,m]=(0,x.useState)(l);return(0,d.jsxs)("div",{className:n,children:[(0,d.jsxs)("div",{className:ed.header,children:[c,(0,d.jsx)("input",{className:ed.input,type:"number",disabled:a,min:i,max:s,step:r,value:u,required:!0,onChange:function(e){let{target:t}=e;t.checkValidity()&&o(t.valueAsNumber),m(t.valueAsNumber)}})]}),(0,d.jsx)(C,{name:t,disabled:a,value:l,min:i,max:s,step:r,onClick:e=>e.stopPropagation(),onValueChange:function(e){o(e),m(e)}})]})});class eh{id;label;data;constructor(e){this.data=e,this.id=e.id,this.label=e.label,this.Input=this.Input.bind(this)}createState(){return function(e){let{min:t,max:n,step:a}=e;return Array.from({length:Math.ceil((n+1-t)/a)},(e,n)=>t+n*a)}(this.data)}Input(e){let{id:t,label:n,min:a,max:l,step:i}=this.data,{value:s,onChange:r}=e;return(0,d.jsx)(em,{name:t,value:s,min:a,max:l,step:i,onChange:r,children:n})}indexOf(e){let{min:t,step:n}=this.data;return(e-t)/n}}let ep={spinner:"I1I0s",numberInput:"NfnaI",controls:"aigYG",legend:"mOTK3"};function ef(e){let{name:t,min:n,max:a,step:l,range:i,onRangeChange:s}=e;return(0,d.jsxs)("label",{className:ep.spinner,children:[(0,d.jsx)("span",{children:t}),(0,d.jsx)(I,{className:ep.numberInput,name:t,value:i[t],min:n,max:a,step:l,onValueChange:function(e){s({...i,[t]:e})}})]})}class ex{data;constructor(e){this.data=e,this.VariableMode=this.VariableMode.bind(this),this.ConstMode=this.ConstMode.bind(this),this.OptionField=this.OptionField.bind(this)}get id(){return this.data.id}createControl(e){let{min:t,max:n,step:a}=e,l=Math.floor((n-t)/a)*a+t;return new eh({...this.data,...e,max:l})}createState(){let{min:e,max:t,step:n,defaultValue:a}=this.data;return[a,{min:e,max:t,step:n}]}ConstMode(e){let{id:t,label:n,min:a,max:l,step:i}=this.data,{value:s,onValueChange:r}=e;return(0,d.jsx)(em,{name:t,value:s,min:a,max:l,step:i,onChange:r,children:n})}VariableMode(e){let{data:t}=this,{range:n,onRangeChange:a}=e,l={...t,range:n,onRangeChange:a};return(0,d.jsxs)("fieldset",{className:ep.body,children:[(0,d.jsx)("legend",{className:ep.legend,children:t.label}),(0,d.jsx)(ef,{...l,name:"min",max:n.max}),(0,d.jsx)(ef,{...l,name:"max",min:n.min}),(0,d.jsx)(ef,{...l,name:"step",min:t.step})]})}populate(e,t){t[this.data.id]=e}OptionField(e){return e.isVariable?this.VariableMode(e):this.ConstMode(e)}}function eg(e){return e({noInitialRun:!0})}function eb(e){let t;return async(n,a)=>{let{data:l,width:i,height:s}=n,r=await (t??=e()),o=performance.now(),c=r.encode(l,i,s,a),u=performance.now();if(!c)throw Error("Encoding error");let d={time:(u-o)/1e3,buffer:c.buffer};return g.yo.transfer(d,[d.buffer])}}function ew(e){let t;return async n=>{let a=(await (t??=e())).decode(n);if(!a)throw Error("Decoding error");return g.yo.transfer(a,[a.data.buffer])}}let ej={GRAYSCALE:1,RGB:2,YCbCr:3},ev={"JPEG Annex K":0,Flat:1,"MSSIM-tuned Kodak":2,ImageMagick:3,"PSNR-HVS-M-tuned Kodak":4,"Klein et al":5,"Watson et al":6,"Ahumada et al":7,"Peterson et al":8},ey={quality:75,baseline:!1,arithmetic:!1,progressive:!0,optimize_coding:!0,smoothing:0,color_space:ej.YCbCr,quant_table:ev.ImageMagick,trellis_multipass:!1,trellis_opt_zero:!1,trellis_opt_table:!1,trellis_loops:1,auto_subsample:!0,chroma_subsample:2,separate_chroma_quality:!1,chroma_quality:75};eb(async()=>eg((await n.e(430).then(n.bind(n,7430))).default));let eC="MozJPEG",eS="image/jpeg",eN="jpg",ek=[new ex({id:"quality",label:"Quality (-q)",min:0,max:100,step:1,defaultValue:ey.quality}),new eu({id:"color_space",label:"Channels",enumObject:ej,defaultValue:"YCbCr"}),new es({id:"auto_subsample",label:"Auto subsample chroma",defaultValue:ey.auto_subsample}),new es({id:"separate_chroma_quality",label:"Separate chroma quality",defaultValue:ey.separate_chroma_quality}),new ex({id:"chroma_quality",label:"Chroma quality",min:0,max:100,step:1,defaultValue:ey.chroma_quality}),new es({id:"baseline",label:"Pointless spec compliance",defaultValue:ey.baseline}),new es({id:"progressive",label:"Progressive",defaultValue:ey.progressive}),new es({id:"optimize_coding",label:"Optimize Huffman table",defaultValue:ey.optimize_coding}),new ex({id:"smoothing",label:"Smoothing",min:0,max:100,step:1,defaultValue:ey.smoothing}),new eu({id:"quant_table",label:"Quantization",enumObject:ev,defaultValue:"ImageMagick"}),new es({id:"trellis_multipass",label:"Trellis multipass",defaultValue:ey.trellis_multipass}),new es({id:"trellis_opt_zero",label:"Optimize zero block runs",defaultValue:ey.trellis_opt_zero}),new es({id:"trellis_opt_table",label:"Optimize after trellis quantization",defaultValue:ey.trellis_opt_table}),new ex({id:"trellis_loops",label:"Trellis quantization passes",min:0,max:50,step:1,defaultValue:ey.trellis_loops})];function eA(e,t){return e.color_space=ej[e.color_space],e.quant_table=ev[e.quant_table],t.mozjpegEncode(e)}let eE={effort:7,quality:75,progressive:!1,epf:-1,lossyPalette:!1,decodingSpeedTier:0,photonNoiseIso:0,lossyModular:!1};eb(async()=>eg((await n.e(726).then(n.bind(n,4726))).default)),ew(async()=>eg((await n.e(986).then(n.bind(n,6986))).default));let eI="JPEG XL",e_="image/jxl",eO="jxl",eV=[new ex({id:"quality",label:"Quality (100 = lossless)",min:0,max:100,step:.1,defaultValue:eE.quality}),new es({id:"lossyPalette",label:"Slight loss",defaultValue:eE.lossyPalette}),new ex({id:"epf",label:"Edge preserving filter (-1 = auto)",min:-1,max:6,step:1,defaultValue:eE.epf}),new ex({id:"decodingSpeedTier",label:"Optimise for decoding speed",min:0,max:4,step:1,defaultValue:eE.decodingSpeedTier}),new ex({id:"photonNoiseIso",label:"Noise equivalent to ISO",min:0,max:5e4,step:100,defaultValue:eE.photonNoiseIso}),new es({id:"progressive",label:"Progressive",defaultValue:eE.progressive}),new ex({id:"effort",label:"Effort",min:3,max:9,step:1,defaultValue:eE.effort})];function eM(e,t){return t.jxlEncode(e)}let eP={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};eb(async()=>eg((await n.e(416).then(n.bind(n,9416))).default));let eR="WebP",eD="image/webp",eF="webp",eL={None:0,"Segment smooth":1,Dithering:2},eT=[{method:0,quality:0},{method:1,quality:20},{method:2,quality:25},{method:3,quality:30},{method:3,quality:50},{method:4,quality:50},{method:4,quality:75},{method:4,quality:90},{method:5,quality:90},{method:6,quality:100}],eq=[new es({id:"lossless",label:"Lossless Mode (-lossless)",defaultValue:eP.lossless}),new ex({id:"method",label:"Method (-m)",min:0,max:6,step:1,defaultValue:eP.method}),new ex({id:"quality",label:"Quality (-q)",min:0,max:100,step:1,defaultValue:eP.quality}),new ex({id:"near_lossless",label:"Near lossless (-near_lossless)",min:0,max:100,step:1,defaultValue:eP.near_lossless}),new es({id:"autofilter",label:"Auto adjust filter strength (-af)",defaultValue:eP.autofilter}),new ex({id:"filter_strength",label:"Filter strength (-f)",min:0,max:100,step:1,defaultValue:eP.filter_strength}),new es({id:"filter_type",label:"User strong filter (-strong)",defaultValue:eP.filter_type}),new ex({id:"filter_sharpness",label:"Filter sharpness (-sharpness)",min:0,max:7,step:1,defaultValue:eP.filter_sharpness}),new es({id:"use_sharp_yuv",label:"Sharp YUV (-sharp_yuv)",defaultValue:eP.use_sharp_yuv}),new ex({id:"pass",label:"Passes (-pass)",min:1,max:10,step:1,defaultValue:eP.pass}),new ex({id:"sns_strength",label:"Spatial noise shaping (-sns)",min:0,max:100,step:1,defaultValue:eP.sns_strength}),new eu({id:"preprocessing",label:"Preprocess (-pre)",enumObject:eL,defaultValue:"None"}),new ex({id:"segments",label:"Segments (-segments)",min:1,max:4,step:1,defaultValue:eP.segments}),new class extends ex{populate(e,t){t.lossless&&Object.assign(t,eT[e])}}({id:"losslessPreset",label:"Lossless Preset (-z)",min:0,max:9,step:1,defaultValue:6})];function ez(e,t){return e.preprocessing=eL[e.preprocessing],t.webpEncode(e)}let eB={YUV400:0,YUV420:1,YUV422:2,YUV444:3},eQ={cqLevel:33,cqAlphaLevel:-1,denoiseLevel:0,tileColsLog2:0,tileRowsLog2:0,speed:6,subsample:eB.YUV420,chromaDeltaQ:!1,sharpness:0,tune:0};eb(async()=>eg((await n.e(486).then(n.bind(n,2486))).default)),ew(async()=>eg((await n.e(334).then(n.bind(n,7334))).default));let eU="AVIF",eG="image/avif",eY="avif",eJ={Auto:0,PSNR:1,SSIM:3},eW=[new ex({id:"cqLevel",label:"Quality (63 = lossless)",min:0,max:63,step:1,defaultValue:eQ.cqLevel}),new eu({id:"subsample",label:"Subsample",enumObject:eB,defaultValue:"YUV420"}),new ex({id:"cqAlphaLevel",label:"Alpha quality (-1 to same with the quality)",min:-1,max:63,step:1,defaultValue:eQ.cqAlphaLevel}),new es({id:"chromaDeltaQ",label:"Extra chroma compression",defaultValue:eQ.chromaDeltaQ}),new ex({id:"sharpness",label:"Sharpness",min:0,max:7,step:1,defaultValue:eQ.sharpness}),new ex({id:"denoiseLevel",label:"Noise synthesis",min:0,max:50,step:1,defaultValue:eQ.denoiseLevel}),new eu({id:"tune",label:"Tuning",enumObject:eJ,defaultValue:"Auto"}),new ex({id:"tileRowsLog2",label:"Log2 of tile rows",min:0,max:6,step:1,defaultValue:eQ.tileRowsLog2}),new ex({id:"tileColsLog2",label:"Log2 of tile cols",min:0,max:6,step:1,defaultValue:eQ.tileColsLog2}),new ex({id:"speed",label:"Speed",min:0,max:10,step:1,defaultValue:eQ.speed})];function eH(e,t){let{cqLevel:n,cqAlphaLevel:a}=e;return e.subsample=eB[e.subsample],e.tune=eJ[e.tune],e.cqLevel=63-n,e.cqAlphaLevel=-1===a?-1:63-a,t.avifEncode(e)}let eK={Auto:3,Vary:0,Half:1,Off:2},eZ={YCoCg:0,YCbCr:1,YIQ:3},eX={quality:75,alpha_quality:75,effort:5,pass:1,sns:50,uv_mode:eK.Auto,csp_type:eZ.YCoCg,error_diffusion:0,use_random_matrix:!1};eb(async()=>eg((await n.e(994).then(n.bind(n,4994))).default)),ew(async()=>eg((await n.e(714).then(n.bind(n,8714))).default));let e$="WebP v2",e0="image/webp2",e1="wp2",e2=[new ex({id:"quality",label:"Quality (100 = lossless)",min:0,max:100,step:.1,defaultValue:eX.quality}),new ex({id:"alpha_quality",label:"Alpha Quality",min:0,max:95,step:.1,defaultValue:eX.alpha_quality}),new ex({id:"effort",label:"Effort",min:0,max:9,step:1,defaultValue:eX.effort}),new ex({id:"pass",label:"Passes",min:0,max:9,step:1,defaultValue:eX.pass}),new ex({id:"sns",label:"Spatial noise shaping",min:0,max:100,step:1,defaultValue:eX.sns}),new ex({id:"error_diffusion",label:"Error diffusion",min:0,max:100,step:1,defaultValue:eX.error_diffusion}),new eu({id:"uv_mode",label:"Subsample chroma",enumObject:eK,defaultValue:"Auto"}),new eu({id:"csp_type",label:"Color space",enumObject:eZ,defaultValue:"YCoCg"}),new es({id:"use_random_matrix",label:"Random matrix",defaultValue:eX.use_random_matrix})];function e4(e,t){return e.uv_mode=eK[e.uv_mode],e.csp_type=eZ[e.csp_type],t.webp2Encode(e)}let e6=[s,r,o,c,u],e3=Object.fromEntries(e6.map(e=>[e.name,e])),e5=e6.map(e=>e.name);function e8(e){return e5.filter(t=>t in e)}async function e9(e){let t=new Image;t.decoding="async",t.src=e;let n=new Promise((e,n)=>{t.onload=()=>e(),t.onerror=()=>n(Error("Image loading error"))});return t.decode&&await t.decode().catch(()=>null),await n,t}/Safari\//.test(navigator.userAgent)&&/Chrom(e|ium)\//.test(navigator.userAgent);let e7=new Map,te=new Map([[/^%PDF-/,"application/pdf"],[/^GIF87a/,"image/gif"],[/^GIF89a/,"image/gif"],[/^\x89PNG\x0D\x0A\x1A\x0A/,"image/png"],[/^\xFF\xD8\xFF/,"image/jpeg"],[/^BM/,"image/bmp"],[/^I I/,"image/tiff"],[/^II*/,"image/tiff"],[/^MM\x00*/,"image/tiff"],[/^RIFF....WEBPVP8[LX ]/s,"image/webp"],[/^\xF4\xFF\x6F/,"image/webp2"],[/^\x00\x00\x00 ftypavif\x00\x00\x00\x00/,"image/avif"],[/^\xff\x0a/,"image/jxl"],[/^\x00\x00\x00\x0cJXL \x0d\x0a\x87\x0a/,"image/jxl"],[/^qoif/,"image/qoi"]]);async function tt(e){let t=Array.from(new Uint8Array(await new Response(e.slice(0,16)).arrayBuffer())).map(e=>String.fromCodePoint(e)).join("");for(let[e,n]of te)if(e.test(t))return n;return""}async function tn(e){let t=URL.createObjectURL(e);try{return await e9(t)}finally{URL.revokeObjectURL(t)}}class ta{factory;workers;remotes=[];queue=[];waiters=[];size=0;terminated=!1;constructor(e,t){if(t<1)throw Error("Worker count must be at least 1");this.factory=e,this.workers=Array(t)}runOnEach(e){let{workers:t,remotes:n}=this,a=t.length;for(;this.size<a;)this.startWorker();return Promise.all(n.map(e))}run(e){return new Promise((t,n)=>this.addJob({task:e,resolve:t,reject:n}))}join(){let{queue:e,waiters:t}=this;return 0===e.length&&this.allWorkerAreFree?Promise.resolve():new Promise((e,n)=>t.push({resolve:e,reject:n}))}terminate(){this.terminated=!0,this.workers.forEach(e=>e?.terminate())}get allWorkerAreFree(){return this.remotes.length===this.size}startWorker(){let e=this.factory(),t=g.yo.probeClient(e),n=this.size++;this.remotes.push(t),this.workers[n]=e}addJob(e){let{workers:t,remotes:n,size:a}=this;0===n.length&&a<t.length&&this.startWorker();let l=n.pop();if(l)return this.runJob(l,e);this.queue.push(e)}async runJob(e,t){let{queue:n,remotes:a,waiters:l}=this,{task:i,resolve:s,reject:r}=t;try{s(await i(e))}catch(e){r(e),l.splice(0,l.length).forEach(t=>t.reject(e))}let o=n.pop();if(o)return this.runJob(e,o);a.push(e),this.allWorkerAreFree&&l.splice(0,l.length).forEach(e=>e.resolve())}}function tl(){return new Worker(new URL(n.p+n.u(44),n.b))}function ti(e){return new ta(tl,e)}function ts(e,t){let{raw:n}=t;if(!("SharedArrayBuffer"in window))return e.runOnEach(e=>e.setOriginal(n));{let t=function(e){let{width:t,height:n,data:a}=e,l=new Uint8ClampedArray(new SharedArrayBuffer(a.byteLength));return l.set(a),{width:t,height:n,data:l}}(n);return e.runOnEach(e=>e.setOriginal(t))}}class tr{workerPool;constructor(e){this.workerPool=e}get(e,t){return new Proxy(e,new to(this.workerPool,t))}}class to{workerPool;method;constructor(e,t){this.workerPool=e,this.method=t}apply(e,t,n){let{workerPool:a,method:l}=this;return a.run(e=>e[l](...n))}}function tc(e){return new Proxy(g.lQ,new tr(e))}async function tu(e){let t="createImageBitmap"in self?await createImageBitmap(e):await tn(e),n=document.createElement("canvas"),{width:a,height:l}=t;n.width=a,n.height=l;let i=n.getContext("2d");if(!i)throw Error("Canvas not initialized");return i.drawImage(t,0,0),i.getImageData(0,0,a,l)}async function td(e){let t=new Blob([e=function(e){let t=new DOMParser().parseFromString(e,"image/svg+xml"),n=t.documentElement;if(n.getAttribute("width")&&n.getAttribute("height"))return e;let a=n.getAttribute("viewBox");if(null===a)throw Error("SVG must have width/height or viewBox");let[,,l,i]=a.split(/\s+/);return n.setAttribute("width",l),n.setAttribute("height",i),new XMLSerializer().serializeToString(t)}(e)],{type:"image/svg+xml"});return function(e,t={}){let{width:n=e.width,height:a=e.height,sx:l=0,sy:i=0,sw:s=e.width,sh:r=e.height}=t,o=document.createElement("canvas");o.width=n,o.height=a;let c=o.getContext("2d");if(!c)throw Error("Could not create canvas context");return c.drawImage(e,l,i,s,r,0,0,n,a),c.getImageData(0,0,n,a)}(await tn(t))}async function tm(e,t){let{type:n}=e;if(n||(n=await tt(e)),"image/svg+xml"===n)return e.text().then(td);if(await function(e){if(!e7.has(e)){let t=(async()=>{let t=document.createElement("picture"),n=document.createElement("img"),a=document.createElement("source");return a.srcset="data:,x",a.type=e,t.append(a,n),await 0,!!n.currentSrc})();e7.set(e,t)}return e7.get(e)}(n))return tu(e);t??=g.yo.probeClient(tl());let a=await e.arrayBuffer();switch(n){case"image/avif":return t.avifDecode(a);case"image/jxl":return t.jxlDecode(a);case"image/webp2":return t.webp2Decode(a);default:return tu(e)}}let th={ratio:{name:"Compression Ratio %",immediately:!0,calc(e,t,n){let{metrics:a,file:l}=n;a.ratio=l.size/t.file.size*100}},SSIM:{name:"SSIM %",async calc(e,t,n,a){let{data:l,metrics:i}=n;i.SSIM=await e.calcSSIM(l,a)*100}},PSNR:{name:"PSNR (db)",async calc(e,t,n){let{data:a,metrics:l}=n;l.PSNR=await e.calcPSNR(a)}},butteraugli:{name:"Butteraugli Score",async calc(e,t,n,a){let{data:l,metrics:i}=n,{width:s,height:r}=l,{score:o,heatMap:c}=await e.calcButteraugli(l,a);i.butteraugli=o,n.heatMap=function(e,t,n){if(4!=e.byteLength/t/n)throw Error("Buffer must be a 8-bit depth RGBA array");let a=document.createElement("canvas").getContext("2d");if(!a)throw Error("Could not create canvas context");let l=a.createImageData(t,n);return l.data.set(new Uint8ClampedArray(e)),l}(c,s,r)}}};function tp(e,t){let n=[],a=[],l=0;for(let t of Object.keys(th)){let{enabled:i,options:s}=e[t]??{enabled:!0};if(!i)continue;let{name:r,calc:o,immediately:c}=th[t];!c&&l++,a.push({calc:o,options:s}),n.push({key:t,name:r})}return{calculations:l,metrics:n,execute:function(e,n,l){return Promise.all(a.map(a=>a.calc(t,e,n,a.options)).filter(Boolean).map(e=>e.then(l)))}}}function tf(e=1){let[t,n]=(0,x.useState)(e),[a,l]=(0,x.useState)(0),[i,s]=(0,x.useState)();return{value:a,max:t,error:i,increase:function(){l(e=>e+1)},reset:function(e){l(0),n(e),s(void 0)},setError:s}}function tx(e){return e.cache||(e.cache=new Map,e.merge=t=>{e(e=>({...e,...t}))},e.set=(t,n)=>{e(e=>({...e,[t]:n}))},e.sub=t=>{let n=e.cache.get(t);return!n&&(n=tx(function(n){if("function"!=typeof n)return e.set(t,n);e(e=>{let a=n(e[t]);return{...e,[t]:a}})}),e.cache.set(t,n)),n}),e}function tg(e,t){let[n,a]=(0,x.useState)(()=>{let n=localStorage.getItem(e);return t(n?JSON.parse(n):void 0)});function l(){localStorage.setItem(e,JSON.stringify(n))}return(0,x.useEffect)(()=>l,[n]),[n,a,l]}let tb=n.p+"s/photo.jpg",tw=n.p+"s/photo-icon.jpg",tj=n.p+"s/artwork.png",tv=n.p+"s/artwork-icon.png",ty=n.p+"s/colorful-text.png",tC=n.p+"s/colorful-text-icon.png",tS={drop:"UGOgT",demoLabel:"FpHBy",demo:"_CJdE",error:"k55Mh",card:"IzGvX",demoIcon:"dbk9Y",demoDescription:"v4CsW",loading:"FIQtP"};function tN(e){let{description:t,url:n,icon:a,onClick:l}=e,[i,s]=(0,x.useState)(!1);async function r(){if(!i){s(!0);try{await l(n)}finally{s(!1)}}}return(0,d.jsxs)("button",{className:tS.card,onClick:r,children:[(0,d.jsx)("img",{src:a,alt:"icon",className:tS.demoIcon}),i&&(0,d.jsx)("div",{className:tS.loading}),(0,d.jsx)("span",{className:tS.demoDescription,children:t})]},n)}function tk(e){let{onCancel:t,onChange:n}=e,a=(0,x.useRef)(new AbortController),[l,i]=(0,x.useState)();function s(e){tm(e).then(t=>n({file:e,raw:t})).catch(i)}async function r(e){let t=new AbortController;a.current.abort(),a.current=t;let{signal:n}=t;try{s(await (0,g.t2)(e,{signal:n}))}catch(e){"AbortError"!==e.name&&i(e)}}return(0,d.jsxs)(V,{onClose:t,children:[(0,d.jsxs)("div",{className:"dialog-content",children:[(0,d.jsx)(G,{className:tS.drop,accept:"image/*",onChange:function(e){s(e[0]),a.current.abort()},onError:i,onSelectStart:()=>i(void 0)}),(0,d.jsxs)("span",{className:tS.demoLabel,children:[U.OrTryOneOfThese,":"]}),(0,d.jsxs)("div",{className:tS.demo,children:[(0,d.jsx)(tN,{description:"Large photo (488KB)",url:tb,icon:tw,onClick:r}),(0,d.jsx)(tN,{description:"Artwork (894KB)",url:tj,icon:tv,onClick:r}),(0,d.jsx)(tN,{description:"Colorful text (68KB)",url:ty,icon:tC,onClick:r})]})]}),(0,d.jsxs)("div",{className:"dialog-actions",children:[(0,d.jsx)("span",{className:tS.error,children:l?.message}),(0,d.jsx)(N,{className:"second",onClick:t,children:"Back"})]})]})}let tA={canvas:"W6BCk",attributes:"l9BSp"};function tE(e){let{isActive:t,value:n}=e,{file:a,raw:l}=n,{width:i,height:s,data:r}=l;if(!1===t)return null;let o=(a.size/r.byteLength*100).toFixed(2);return(0,d.jsxs)("div",{className:"dialog-content",role:"tabpanel",children:[(0,d.jsx)("canvas",{className:tA.canvas,"aria-label":U.Preview,ref:e=>P(l,e),width:i,height:s}),(0,d.jsxs)("dl",{className:tA.attributes,children:[(0,d.jsxs)("dt",{children:[U.FileName,":"]}),(0,d.jsx)("dd",{children:a.name}),(0,d.jsxs)("dt",{children:[U.FileType,":"]}),(0,d.jsx)("dd",{children:a.type}),(0,d.jsxs)("dt",{children:[U.Resolution,":"]}),(0,d.jsxs)("dd",{children:[i," x ",s]}),(0,d.jsxs)("dt",{children:[U.RawSize,":"]}),(0,d.jsx)("dd",{children:g.tZ.formatDiv(r.byteLength)}),(0,d.jsxs)("dt",{children:[U.FileSizeAndRatio,":"]}),(0,d.jsxs)("dd",{children:[g.tZ.formatDiv(a.size)," (",o,"%)"]})]})]})}var tI=n(4120);let t_={hfAsymmetry:1,goodQualitySeek:1.5,badQualitySeek:.5},tO={form:"ythjm dialog-content",subfields:"pqrw6",field:"wUeLr",inlineLabel:"QQbNk",label:"Uafzz",select:"mBcvZ"};function tV(e){return e||{version:1,workerCount:navigator.hardwareConcurrency,encodeTime:{enabled:!1},SSIM:{enabled:!0,options:tI.getOptions()},PSNR:{enabled:!1},butteraugli:{enabled:!1,options:t_}}}function tM(e){let{label:t,children:n}=e;return(0,d.jsxs)("label",{className:tO.field,children:[(0,d.jsx)("span",{className:tO.label,children:t}),n]})}function tP(e){let{isActive:t,hasEncodePhase:n,value:a,onChange:l}=e,{workerCount:i,encodeTime:s,SSIM:r,PSNR:o,butteraugli:c}=a,u=e=>{let{currentTarget:t}=e,n=function(e){if("SELECT"===e.tagName)return e.value;switch(e.type){case"number":return e.valueAsNumber;case"checkbox":return e.checked;default:return e.value}}(t);!function(e,t,n){let a=t.split(".");e(e=>(function e(t,l){let i=a[l],s=n;return l<a.length-1&&(s=e(t[i],l+1)),{...t,[i]:s}})(e,0))}(l,t.name,n)};return(u=(0,x.useCallback)(u,[]),!1===t)?null:(0,d.jsxs)("form",{className:tO.form,role:"tabpanel",children:[(0,d.jsxs)("label",{children:[(0,d.jsxs)("span",{className:tO.inlineLabel,children:[U.ThreadCount,":"]}),(0,d.jsx)(I,{name:"workerCount",value:i,min:1,step:1,onChange:u})]}),n&&(0,d.jsxs)(et,{checked:s.enabled,name:"encodeTime.enabled",onChange:u,children:[U.MeasureEncodeTime,":"]}),(0,d.jsx)(et,{checked:o.enabled,name:"PSNR.enabled",onChange:u,children:U.MeasurePSNR}),(0,d.jsx)(et,{checked:r.enabled,name:"SSIM.enabled",onChange:u,children:U.MeasureSSIM}),(0,d.jsxs)("fieldset",{className:tO.subfields,children:[(0,d.jsx)(tM,{label:"Algorithm",children:(0,d.jsxs)("select",{name:"SSIM.options.ssim",value:r.options.ssim,className:tO.select,onChange:u,children:[(0,d.jsx)("option",{children:"fast"}),(0,d.jsx)("option",{children:"original"}),(0,d.jsx)("option",{children:"bezkrovny"}),(0,d.jsx)("option",{children:"weber"})]})}),(0,d.jsx)(tM,{label:"k1",children:(0,d.jsx)(I,{name:"SSIM.options.k1",value:r.options.k1,min:0,step:.01,onChange:u})}),(0,d.jsx)(tM,{label:"k2",children:(0,d.jsx)(I,{name:"SSIM.options.k2",value:r.options.k2,min:0,step:.01,onChange:u})}),(0,d.jsx)(tM,{label:"window size",children:(0,d.jsx)(I,{name:"SSIM.options.windowSize",value:r.options.windowSize,min:1,step:1,onChange:u})})]}),(0,d.jsx)(et,{name:"butteraugli.enabled",checked:c.enabled,onChange:u,children:"Butteraugli"}),(0,d.jsxs)("fieldset",{className:tO.subfields,children:[(0,d.jsx)(tM,{label:"hf-asymmetry",children:(0,d.jsx)(I,{name:"butteraugli.options.hfAsymmetry",value:c.options.hfAsymmetry,min:0,max:2,step:.1,onChange:u})}),(0,d.jsx)(tM,{label:"goodQualitySeek",children:(0,d.jsx)(I,{name:"butteraugli.options.goodQualitySeek",value:c.options.goodQualitySeek,min:0,max:2,step:.1,onChange:u})}),(0,d.jsx)(tM,{label:"badQualitySeek",children:(0,d.jsx)(I,{name:"butteraugli.options.badQualitySeek",value:c.options.badQualitySeek,min:0,max:2,step:.1,onChange:u})})]})]})}let tR={container:"L_iEW dialog-content",tablist:"KeoMs",tab:"klA_i",active:"KrAuU",name:"eQrOv",form:"JFomU"},tD={form:"cDgD4",constant:"HTzgE OkYG8",variable:"A9apK OkYG8"},tF=(0,x.memo)(e=>{let t,n,a;let{template:l,state:i,onChange:s}=e,{isVariable:r}=i,{OptionField:o}=l;return r?(n=tD.variable,t="Range Mode",a=(0,d.jsx)(F.Cqf,{})):(n=tD.constant,t="Constant Mode",a=(0,d.jsx)(F.m3S,{})),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(N,{className:n,title:t,type:"text",onClick:function(){s.set("isVariable",!r)},children:a}),(0,d.jsx)(o,{...i,onValueChange:s.sub("value"),onRangeChange:s.sub("range")})]})});function tL(e){let{templates:t,className:n,state:a,onChange:l}=e,i=t.map(e=>{let{id:t}=e;return(0,d.jsx)(tF,{template:e,state:a[t],onChange:l.sub(t)},t)});return(0,d.jsx)("form",{className:(0,w.A)(tD.form,n),children:i})}function tT(e){let t=e??{};for(let e of e6)t[e.name]??={enable:!1,state:function(e){let t={};for(let n of e.templates){let[e,a]=n.createState();t[n.id]={value:e,range:a,isVariable:!1}}return t}(e)};if(!e){let{quality:e}=t.WebP.state;t.WebP.enable=!0,e.range.step=5,e.isVariable=!0}return t}tF.displayName="Option";let tq=x.memo(function(e){let{isActive:t,value:n,onChange:a}=e,[l,i]=(0,x.useState)("WebP"),s=e6.map(({name:e})=>{let t=(0,w.A)(tR.tab,e===l&&tR.active),s=a.sub(e).sub("enable");return(0,d.jsxs)("button",{className:t,type:"button",onClick:()=>i(e),children:[(0,d.jsx)(et,{checked:n[e].enable,onClick:M,onCheckedChange:s}),(0,d.jsx)("span",{className:tR.name,children:e})]},e)}),r=(0,w.A)(tR.container,!1===t&&"hidden");return(0,d.jsxs)("div",{className:r,role:"tabpanel",children:[(0,d.jsx)("div",{className:tR.tablist,children:s}),(0,d.jsx)(tL,{templates:e3[l].templates,className:tR.form,state:n[l].state,onChange:a.sub(l).sub("state")})]})}),tz={dialog:"Hfe29",header:"S_q85",title:"jzzhN",tab:"EiM0W"};function tB(e){let{image:t,onStart:n,onClose:a,onSelectFile:l}=e,[i,s]=(0,x.useState)(0),[r,o]=tg("Encoding",tT),[c,u]=tg("Measure",tV),m=t&&Object.values(r).some(e=>e.enable);return(0,d.jsxs)(V,{name:U.AnalysisConfig,className:tz.dialog,onClose:a,children:[(0,d.jsxs)(K,{className:tz.header,index:i,onChange:s,children:[(0,d.jsx)("button",{type:"button",className:tz.tab,children:U.Information}),(0,d.jsx)("button",{type:"button",className:tz.tab,children:U.Encoders}),(0,d.jsx)("button",{type:"button",className:tz.tab,children:U.Analysis})]}),(0,d.jsxs)(Z,{index:i,children:[(0,d.jsx)(tE,{value:t}),(0,d.jsx)(tq,{value:r,onChange:tx(o)}),(0,d.jsx)(tP,{hasEncodePhase:!0,value:c,onChange:u})]}),(0,d.jsxs)("div",{className:"dialog-actions",children:[(0,d.jsxs)(N,{onClick:l,children:[U.SelectFile,"..."]}),(0,d.jsx)(N,{className:"second",onClick:a,children:U.Cancel}),(0,d.jsx)(N,{disabled:!m,onClick:function(){n({encoding:r,measurement:c})},children:U.Start})]})]})}let tQ={content:"TPOjK dialog-content",text:"u_6aN",error:"J6RrZ",progress:"PrOo_",buttons:"KregG dialog-actions"};function tU(e){let{value:t,max:n,error:a,onCancel:l}=e,i=(0,x.useRef)(performance.now()),s=(0,x.useRef)(0),[r,o]=(0,x.useState)("--:--:--");return(0,x.useEffect)(function(){return s.current=window.setInterval(function(){o(new Date(performance.now()-i.current).toISOString().substr(11,8))},1e3),()=>window.clearInterval(s.current)},[]),(0,x.useEffect)(function(){a&&window.clearInterval(s.current)},[a]),(0,d.jsxs)(V,{onClose:l,children:[(0,d.jsxs)("div",{className:tQ.content,children:[(0,d.jsxs)("h1",{children:[U.Encoding,"..."]}),a&&(0,d.jsxs)("p",{className:tQ.error,children:[U.Error,": ",a]}),(0,d.jsxs)("div",{className:tQ.text,children:[(0,d.jsxs)("span",{children:[t," / ",n]}),(0,d.jsxs)("span",{children:[U.ElapsedTime,": ",r]})]}),(0,d.jsx)("progress",{value:t,max:n,className:tQ.progress})]}),(0,d.jsx)("div",{className:tQ.buttons,children:(0,d.jsx)(N,{className:"second",onClick:l,children:U.Cancel})})]})}class tG{worker;taskQueue=[];measurer;outputSize;onProgress=g.lQ;constructor(e,t){for(let n of(this.worker=t,this.outputSize=0,this.measurer=tp(e.measurement,t),e.measurement.encodeTime.enabled&&this.measurer.metrics.push({key:"time",name:U.EncodeTimeSecond}),e6)){let{name:t}=n,{enable:a,state:l}=e.encoding[t];if(!a)continue;let i=function(e,t){let{defaultOptions:n,templates:a}=e,l={},i={...n},s=[],r=[],o=1;for(let e of a){let{isVariable:n,value:a,range:r}=t[e.id];if(n){let t=e.createControl(r),n=t.createState();o*=n.length,s.push(t),l[e.id]=n}else e.populate(a,i)}let c=1;for(let e=s.length-1;e>=0;e--)r.push(c),c*=l[s[e].id].length;return{size:o,variables:l,constants:i,controls:s,weights:r}}(n,l);this.outputSize+=i.size,this.taskQueue.push({encoder:n,profile:i})}}get TaskCount(){return this.outputSize*(1+this.measurer.calculations)}async run(e){let{measurer:t,taskQueue:n}=this,a=[],l=new Map,i=new Map,s=Object.create(null);for(let{encoder:t,profile:r}of n){let{variables:n,constants:o,controls:c,weights:u}=r;for(let r of(s[t.name]=c,i.set(t.name,a.length),l.set(t.name,u),(0,g.Kt)(n))){let n={...o,...r};a.push(this.process(e,t,n))}}return{input:e,seriesMeta:t.metrics,controlsMap:s,outputs:await Promise.all(a),offsetMap:i,weightMap:l}}async process(e,t,n){let{worker:a,measurer:l}=this,{extension:i,mimeType:s}=t,{buffer:r,time:o}=await t.encode(n,a);this.onProgress();let c=new File([r],e.file.name.replace(/.[^.]*$/,`.${i}`),{type:s}),u={file:c,data:await tm(c,a),metrics:{time:o}};return await l.execute(e,u,this.onProgress),u}}function tY(e){let{isOpen:t,onClose:n,onChange:a}=e,[l,i]=(0,x.useState)(!0),[s,r]=(0,x.useState)(),[o,c]=(0,x.useState)(),u=tf();async function m(e){r(e),i(!1)}async function h(e){if(!s)throw Error("File is null");let{measurement:t}=e,n=ti(t.workerCount),l=new tG(e,tc(n));u.reset(l.TaskCount),l.onProgress=u.increase,c(n);try{await ts(n,s),a(await l.run(s)),c(void 0)}catch(e){console.error(e),u.setError(e.message)}finally{n.terminate()}}return t?o?(0,d.jsx)(tU,{value:u.value,max:u.max,error:u.error,onCancel:function(){o.terminate(),c(void 0)}}):l?(0,d.jsx)(tk,{onCancel:function(){s?i(!1):n()},onChange:m}):(0,d.jsx)(tB,{image:s,onStart:h,onClose:n,onSelectFile:()=>i(!0)}):null}let tJ=n.p+"s/intro-banner.png",tW={header:"yJKBD",banner:"L1TiO",title:"_p6qL",subTitle:"ESl2O",bigButton:"vDu8Z",github:"_6hzZZ",unsplash:"y8Kpk",link:"dzg8y",links:"hzS8p jH_ql",card:"oPIj1"};function tH(e){let{onEncode:t,onCompare:n}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("section",{className:tW.header,children:[(0,d.jsx)("img",{className:tW.banner,alt:"banner",src:tJ}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:tW.title,children:"ICAnalyzer"}),(0,d.jsx)("h2",{className:tW.subTitle,children:U.ICAnalyzerIntro}),(0,d.jsx)(N,{className:tW.bigButton,type:"outline",onClick:t,children:"Convert"}),(0,d.jsx)(N,{className:tW.bigButton,type:"outline",onClick:n,children:"Compare"}),(0,d.jsxs)(N,{className:(0,w.A)(tW.bigButton,"second"),type:"outline",href:"https://github.com/Kaciras/ICAnalyzer",children:[(0,d.jsx)(A.Zv0,{className:tW.github}),U.SourceCode]})]}),(0,d.jsxs)("div",{className:tW.unsplash,children:["Photo by",(0,d.jsx)("a",{className:tW.link,href:"https://unsplash.com/@veverkolog?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText",children:"Dušan veverkolog"}),"on",(0,d.jsx)("a",{className:tW.link,href:"https://unsplash.com/s/photos/eagle?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText",children:"Unsplash"})]})]}),(0,d.jsxs)("section",{className:tW.links,children:[(0,d.jsxs)("div",{className:tW.card,children:[(0,d.jsx)("h2",{children:"Documents"}),(0,d.jsx)("a",{href:"https://github.com/Kaciras/ICAnalyzer/wiki/Tutorial-(Chinese)",children:"Tutorial (Chinese)"})]}),(0,d.jsxs)("div",{className:tW.card,children:[(0,d.jsx)("h2",{children:"Articles"}),(0,d.jsx)("a",{href:"https://blog.kaciras.com/article/24/analyze-WebP-encode-options",children:"WebP 参数分析"}),(0,d.jsx)("a",{href:"https://blog.kaciras.com/article/23/icanalyzer-development-log",children:"ICAnalyzer 开发小记"})]})]})]})}let tK={darkNumberInput:"uy3Os"},tZ={container:"whtRc",tabPanel:"qJPp5 controls",option:"TkDnU",icon:"YQqTa",main:"lJ0_5",wrapper:"neMG8",canvas:"CLvOQ",controls:"vSPoB",separator:"XSXEu"};!function(e){e[e.Split=0]="Split",e[e.Input=1]="Input",e[e.Output=2]="Output",e[e.Diff=3]="Diff",e[e.HeatMap=4]="HeatMap"}(a||(a={}));let tX=[U.SplitView,U.InputView,U.OutputView,U.DiffView,U.HeatMapView],t$={x:0,y:0,scale:1};function t0(e){let t;let{original:n,output:a,className:l}=e,{width:i,height:s}=n.raw,{heatMap:r}=a,[o,c]=(0,x.useState)(t$),[u,m]=(0,x.useState)(2),[h,p]=(0,x.useState)(1),[f,g]=(0,x.useState)(!1),[b,j]=(0,x.useState)(!1),[v,y]=(0,x.useState)({clientX:0,clientY:0}),[C,S]=(0,x.useState)(window.innerWidth/2),k=(0,x.useRef)(null),A=(0,x.useRef)(null),E=4===u?r:a.data;(0,x.useEffect)(function(){c(t$),P(n.raw,k.current)},[n]),(0,x.useEffect)(function(){P(E,A.current)},[E]);let _=tX.map(e=>({target:e}));r||(_[4].disabled=!0,_[4].title=U.RequireButteraugli);let O=_.map((e,t)=>{let{target:n,disabled:a,title:l}=e;return(0,d.jsx)(N,{className:"dark",type:"text",active:u===t,disabled:a,title:l,onClick:()=>m(t),children:n},t)}),V=1;3===u&&(t="difference",V=h);let M={width:i,height:s,"--scale":o.scale,"--x":o.x+"px","--y":o.y+"px","--brightness":`${V}`},L=0===u?{"--split":`${C}px`}:void 0,{clientX:T,clientY:q}=v,B=Math.floor((T-o.x-(window.innerWidth-i*o.scale)/2)/o.scale),Q=Math.floor((q-o.y-(window.innerHeight-s*o.scale)/2)/o.scale),G=R(e=>{let t=e.pageX;t>0&&t<window.innerWidth&&S(t)});return(0,d.jsxs)("div",{className:(0,w.A)(tZ.container,l),style:L,children:[(0,d.jsx)(D,{className:tZ.main,state:o,onChange:e=>e.scale>.01&&c(e),children:(0,d.jsxs)("div",{className:tZ.wrapper,style:M,onPointerOver:()=>j(!0),onPointerMove:function(e){let{clientX:t,clientY:n}=e;y({clientX:t,clientY:n})},onPointerOut:()=>j(!1),children:[(0,d.jsx)("canvas",{className:tZ.canvas,ref:k,width:i,height:s}),(0,d.jsx)("canvas",{className:tZ.canvas,ref:A,width:i,height:s,style:{mixBlendMode:t},hidden:1===u})]})}),(0,d.jsx)("div",{hidden:0!==u,className:tZ.separator,onPointerDown:G}),(0,d.jsxs)("div",{className:tZ.tabPanel,children:[(0,d.jsx)("div",{children:O}),(0,d.jsxs)("div",{className:tZ.option,title:U.PickColor,children:[(0,d.jsx)(F.jBq,{className:tZ.icon}),(0,d.jsx)(z,{checked:f,onCheckedChange:g})]}),3===u&&(0,d.jsxs)("label",{className:tZ.option,title:U.Brightness,children:[(0,d.jsx)(F.Xx6,{className:tZ.icon}),(0,d.jsx)(I,{value:h,min:1,max:255,step:1,minMaxButton:!0,className:tK.darkNumberInput,onValueChange:p})]})]}),(0,d.jsx)(ee,{className:tZ.controls,defaultValue:t$,value:o,onChange:c}),f&&b&&(0,d.jsx)(H,{style:{top:q,left:T},x:B,y:Q,imageA:n.raw,imageB:a.data})]})}var t1=n(5449),t2=n.n(t1),t4=n(8306),t6=n.n(t4),t3=n(8804),t5=n.n(t3);let t8={container:"OaOPZ controls",chart:"wcsI3",lock:"X8mfJ dark"};t6()(t2()),t5()(t2());let t9={accessibility:{enabled:!1},chart:{styledMode:!0,animation:!1},title:{text:""},tooltip:{borderRadius:0},legend:{verticalAlign:"top",width:450,alignColumns:!1},xAxis:{width:430},lang:{downloadSVG:U.DownloadSVG},exporting:{menuItemDefinitions:{downloadExpand:{text:U.DownloadFullAxis,onclick(){let e=Array(this.yAxis.length);e.fill({visible:!0});let t={yAxis:e,xAxis:{title:{text:this.options.xLabel},plotLines:[]},legend:{labelFormat:"{name}",labelFormatter:void 0}};this.exportChartLocal({type:"image/svg+xml"},t)}}},buttons:{contextButton:{y:5,x:-5,height:32,width:32,symbolSize:16,symbolX:17,symbolY:16,menuItems:["downloadSVG","downloadExpand"]}},sourceWidth:720,sourceHeight:405,chartOptions:{legend:{width:null},xAxis:{width:null},chart:{className:"exporting_chart_class"}}}};function t7(e,t){let{yAxis:n}=e;for(let e=1;e<n.length;e++)n[e].update({visible:t===e},!1);e.redraw()}function ne(e){let{series:t}=e;for(let n=1;n<t.length;n++){let{element:a}=t[n].legendItem.group;a.onmouseenter=()=>t7(e,n)}}function nt(e){let{className:t,visible:n,seriesMeta:a,outputs:l,index:i,xLabel:s,values:r}=e,[o,c]=(0,x.useState)(),[u,m]=(0,x.useState)(!1);return(0,x.useEffect)(()=>o&&void(o.options.xLabel=s,o.xAxis[0].setCategories(r,!1),o.series.forEach((e,t)=>{let{key:n}=a[t];e.setData(l.map(e=>e.metrics[n]),!1)})),[l]),(0,x.useEffect)(()=>o&&function(e){let[t]=e.xAxis;t.removePlotLine("MarkLine"),t.addPlotLine({id:"MarkLine",value:i,dashStyle:"Dash"}),e.legend.update({labelFormatter(){let e;let{name:t,options:n}=this,a=n.data[i];switch(a){case Infinity:e="∞";break;case-1/0:e="-∞";break;default:e=a.toFixed(2)}return`${t}: <b>${e}</b>`}}),ne(e)}(o)),(0,d.jsxs)("section",{className:(0,w.A)(t8.container,t),style:n?void 0:{display:"none"},children:[(0,d.jsx)(N,{title:U.LockYAxis,type:"text",className:t8.lock,active:u,onClick:function(){if(u){let e={min:null,max:null};o.yAxis.forEach(t=>t.update(e,!1)),m(!1)}else m(!0),o.yAxis.forEach(e=>e.update({min:e.min,max:e.max}),!1);o.redraw()},children:(0,d.jsx)(A.k$A,{})}),(0,d.jsx)("div",{className:t8.chart,ref:function(t){if(!t||o)return;let n=function(e){let{seriesMeta:t,outputs:n,values:a,xLabel:l}=e,{length:i}=t,s=Array(i),r=Array(i);for(let e=0;e<i;e++){let{key:a,name:l}=t[e];r[e]={title:{text:l},visible:!1,opposite:!0},s[e]={name:l,type:"line",yAxis:e,data:n.map(e=>e.metrics[a])}}let[o,c]=r;return o.visible=!0,o.opposite=!1,c&&(c.visible=!0),{series:s,yAxis:r,xAxis:{categories:a},xLabel:l}}(e),a=t2().merge(t9,n),l=t2().chart(t,a);c(l),function(e){let{series:t}=e;for(let n=1;n<t.length;n++)t[n].onMouseOver=()=>t7(e,n)}(l),ne(l)}})]})}let nn={container:"XXq7Z controls",field:"yHhVc",active:"msmSz"};function na(e){let{type:t,id:n,targetType:a,targetId:l,children:i,onChange:s}=e,r=(0,w.A)(nn.field,{[nn.active]:a===t&&l===n});return(0,d.jsx)("div",{className:r,onClick:function(){s({varType:a,varId:l})},children:i})}function nl(e){let{controlsMap:t,value:n,onChange:a}=e,{varType:i,varId:s,codec:r,stateMap:o}=n;if(i===l.None)return null;let c=o[r],u=a.sub("stateMap").sub(r),m=t[r].map(({id:e,Input:t},n)=>(0,d.jsx)(na,{type:i,id:s,targetType:l.Option,targetId:e,onChange:a.merge,children:(0,d.jsx)(t,{value:c[n],onChange:u.sub(n)})},e)),h=e8(t).map(e=>(0,d.jsx)("option",{value:e,children:e},e));return h.length>1&&m.push((0,d.jsx)(na,{type:i,id:s,targetType:l.Encoder,targetId:"",onChange:a.merge,children:(0,d.jsx)(T,{title:U.Codec,value:r,onValueChange:a.sub("codec"),children:h})},"codec")),(0,d.jsx)("form",{className:nn.container,children:m})}let ni={buttonPanel:"xoSIJ controls",iconButton:"UdC8r dark",imageView:"Pe9Kx",metricsPanel:"BTorj",simple:"OrDdk controls BTorj"};function ns(e){let{visible:t,metas:n,metrics:a}=e;if(!t)return null;let l=[];for(let{key:e,name:t}of n){let n=a[e].toFixed(3);l.push((0,d.jsxs)("dt",{children:[t,":"]},t)),l.push((0,d.jsx)("dd",{children:n},e))}return(0,d.jsx)("dl",{className:ni.simple,children:l})}function nr(e,t,n){let a=0;for(let l=0;l<e.length;l++){let i=e[l].indexOf(n[l]);a+=t[l]*i}return a}function no(e){let{result:t,onStart:n,onClose:a}=e,{input:l,controlsMap:i,seriesMeta:s}=t,[r,o]=(0,x.useState)(!0),[c,u]=(0,x.useState)(()=>(function(e){let t=0,n="",a=Object.entries(e);a.length>1&&(t=1,n="");let[l,i]=a[0];i.length>0&&(t=2,n=i[0].id);let s={};for(let[e,t]of a){let n=[];for(let e of t)n.push(e.createState()[0]);s[e]=n}return{varType:t,varId:n,codec:l,stateMap:s}})(i)),{labels:m,series:h,output:p,varName:f}=(0,x.useMemo)(()=>(function(e,t){let n,a,l,i;let{controlsMap:s,offsetMap:r,outputs:o,weightMap:c}=e,{varType:u,varId:d,codec:m,stateMap:h}=t;if(0===u)n=[""],i="",l=(a=o)[0];else if(1===u)l=(a=(n=e8(h)).map(e=>{let t=r.get(e),n=s[e],a=h[e];return o[t+nr(n,c.get(e),a)]}))[n.indexOf(m)],i="Encoding";else if(2===u){let e=s[m],t=e.findIndex(e=>e.id===d),u=e[t].createState(),p=h[m],f=c.get(m),x=r.get(m),g=f[t],b=x+nr(e,f,p),w=b-e[t].indexOf(p[t])*g;n=u.map(e=>e.toString()),l=o[b],a=u.map((e,t)=>o[w+g*t]),i=e[t].label}else throw Error("Missing handle of variable type: "+u);return{output:l,labels:n,series:a,varName:i}})(t,c),[t,c]),g=h.indexOf(p);if(g<0)throw Error("Can't find current index in series");return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(t0,{className:ni.imageView,original:l,output:p}),1===t.outputs.length?(0,d.jsx)(ns,{visible:r,metas:s,metrics:p.metrics}):(0,d.jsx)(nt,{className:ni.metricsPanel,visible:r,seriesMeta:s,index:g,xLabel:f,values:m,outputs:h}),(0,d.jsxs)("div",{className:ni.buttonPanel,children:[(0,d.jsx)(N,{title:U.Back,type:"text",className:ni.iconButton,onClick:a,children:(0,d.jsx)(A.$9n,{})}),(0,d.jsx)(N,{title:U.SelectFile,type:"text",className:ni.iconButton,onClick:n,children:(0,d.jsx)(A.GtS,{})}),(0,d.jsx)(N,{title:U.ShowMetrics,type:"text",className:ni.iconButton,active:r,onClick:()=>o(!r),children:(0,d.jsx)(A.JKR,{})}),(0,d.jsx)(k,{title:U.DownloadOutput,type:"text",className:ni.iconButton,file:p.file,children:(0,d.jsx)(A.FHN,{})})]}),(0,d.jsx)(nl,{controlsMap:i,value:c,onChange:tx(u)})]})}!function(e){e[e.None=0]="None",e[e.Encoder=1]="Encoder",e[e.Option=2]="Option"}(l||(l={}));var nc=n(6582);let nu={dialog:"VoT92",list:"ViILv",placeholder:"KQ202 ViILv",listitem:"va1tQ",dragging:"JzKW7",canvas:"wP4OW",attrLine:"Y3AB9",filename:"EsDQb",reset:"XqnDt",mime:"BZ6nn",right:"NTr6z",fileDrop:"RIyze",error:"D3F6B",actions:"QJgkG dialog-actions"},nd=(0,x.forwardRef)((e,t)=>{let{value:n,index:a,isDragging:l,onRemove:i,...s}=e,{file:r,raw:o}=n,{type:c,size:u}=r,{width:m,height:h}=o,p=(0,x.useRef)(null);(0,x.useEffect)(()=>P(o,p.current),[o]);let f=(0,w.A)(nu.listitem,l&&nu.dragging);return(0,d.jsxs)("li",{...s,className:f,ref:t,children:[(0,d.jsx)("canvas",{className:nu.canvas,ref:p,width:m,height:h}),(0,d.jsxs)("div",{className:nu.attrLine,children:[0===a?(0,d.jsx)("span",{children:"Original"}):(0,d.jsxs)("span",{children:["# ",a-1]}),(0,d.jsx)(N,{className:nu.reset,type:"text",title:U.Remove,onClick:i,children:(0,d.jsx)(A.$9n,{})})]}),(0,d.jsx)("div",{className:nu.filename,children:r.name}),(0,d.jsxs)("div",{className:nu.attrLine,children:[(0,d.jsx)("span",{className:nu.mime,children:c}),"(",m," x ",h,", ",g.tZ.formatDiv(u),")"]})]})});function nm(e){let{value:t,onChange:n}=e,a=t.map((e,a)=>(0,d.jsx)(nc.sx,{draggableId:e.id.toString(),index:a,children:(l,i)=>(0,d.jsx)(nd,{...l.draggableProps,...l.dragHandleProps,ref:l.innerRef,isDragging:i.isDragging,value:e,index:a,onRemove:()=>(function(e){let a=Array.from(t);a.splice(e,1),n(a)})(a)})},e.id));return(0,d.jsx)(nc.JY,{onDragEnd:function(e){let{source:a,destination:l}=e;if(!l)return;let i=[...t],[s]=i.splice(a.index,1);i.splice(l.index,0,s),n(i)},children:(0,d.jsx)(nc.gL,{droppableId:"compare",children:e=>(0,d.jsxs)("ol",{className:nu.list,ref:e.innerRef,...e.droppableProps,children:[a,e.placeholder]})})})}function nh(e){let{data:t,onAccept:n,onCancel:a}=e,[l,i]=(0,x.useState)(()=>t?[t.original,...t.changed]:[]),s=(0,x.useRef)(),[r,o]=(0,x.useState)();(0,x.useEffect)(function(){let e=ti(navigator.hardwareConcurrency);return s.current=tc(e),()=>e.terminate()},[]);let c=l.length<2||!!r;return(0,d.jsxs)(V,{className:nu.dialog,onClose:a,children:[l.length>0?(0,d.jsx)(nm,{value:l,onChange:i}):(0,d.jsxs)("div",{className:nu.placeholder,children:[(0,d.jsx)("p",{children:U.AddAtLeast2Images}),(0,d.jsx)("p",{children:U.FirstIsTheOriginal}),(0,d.jsx)("p",{children:U.DndToReorder})]}),(0,d.jsxs)("div",{className:nu.right,children:[(0,d.jsx)(G,{className:nu.fileDrop,accept:"image/*",multiple:!0,onChange:function(e){let t=[];for(let n of e)t.push(tm(n,s.current).then(e=>({file:n,raw:e,id:(0,g.NF)()})));Promise.all(t).then(e=>i([...l,...e])).catch(o)},onError:o,onSelectStart:()=>o(void 0)}),(0,d.jsx)("div",{className:nu.error,children:r?.message}),(0,d.jsxs)("div",{className:nu.actions,children:[(0,d.jsx)(N,{className:"second",onClick:a,children:"Back"}),(0,d.jsx)(N,{disabled:c,onClick:function(){n({original:l[0],changed:l.slice(1)})},children:"Next"})]})]})]})}function np(e){let{onStart:t,onClose:n,onSelectFile:a}=e,[l,i]=tg("Measure",tV);return(0,d.jsxs)(V,{name:U.MeasureOptions,className:tz.dialog,onClose:n,children:[(0,d.jsx)("h2",{className:tz.title,children:U.MeasureOptions}),(0,d.jsx)(tP,{value:l,onChange:i}),(0,d.jsxs)("div",{className:"dialog-actions",children:[(0,d.jsx)(N,{onClick:a,children:"Select files..."}),(0,d.jsx)(N,{className:"second",onClick:n,children:"Cancel"}),(0,d.jsx)(N,{onClick:()=>t(l),children:"Next"})]})]})}function nf(e){let{isOpen:t,onChange:n,onClose:a}=e,[l,i]=(0,x.useState)(!0),[s,r]=(0,x.useState)(),[o,c]=(0,x.useState)(),u=tf();async function m(e){if(!s||!e)throw Error("Missing required data");let{original:t,changed:a}=s,l=new eh({id:"i",label:"Index",min:0,step:1,max:s.changed.length-1}),i=ti(e.workerCount),r=tp(e,tc(i));c(i),await ts(i,t);let o=[];for(let e=0;e<a.length;e++){let{raw:n,file:l}=a[e],i={file:l,data:function(e,t){let{width:n,height:a}=e,{width:l,height:i}=t;return n===l&&a===i?e:function(e,t,n,a,l,i,s,r){let o=document.createElement("canvas");o.width=e.width,o.height=e.height,function(e,t){let n=e.getContext("2d");if(!n)throw Error("Canvas not initialized");n.clearRect(0,0,e.width,e.height),n.putImageData(t,0,0)}(o,e);let c=document.createElement("canvas");c.width=i,c.height=s;let u=c.getContext("2d");if(!u)throw Error("Could not create canvas context");return"pixelated"===r?u.imageSmoothingEnabled=!1:u.imageSmoothingQuality=r,u.drawImage(o,0,0,a,l,0,0,i,s),u.getImageData(0,0,i,s)}(e,0,0,n,a,l,i,"high")}(n,t.raw),metrics:{}};o.push(i),r.execute(t,i,u.increase)}u.reset(a.length*(1+r.calculations));try{await i.join(),c(void 0),n({input:t,outputs:o,offsetMap:new Map([["_",0]]),weightMap:new Map([["_",[1]]]),seriesMeta:r.metrics,controlsMap:{_:[l]}})}catch(e){console.error(e),u.setError(e.message)}finally{i.terminate()}}return t?l?(0,d.jsx)(nh,{data:s,onAccept:function(e){r(e),i(!1)},onCancel:function(){s?i(!1):a()}}):o?(0,d.jsx)(tU,{value:u.value,max:u.max,error:u.error,onCancel:function(){o.terminate(),c(void 0)}}):(0,d.jsx)(np,{onStart:m,onClose:a,onSelectFile:()=>i(!0)}):null}nd.displayName="PreviewBox",function(e){e[e.None=0]="None",e[e.Compress=1]="Compress",e[e.Compare=2]="Compare"}(i||(i={})),window.__isSupport__&&h.T({dsn:"https://d101904fac2c486ea6f8563c2cf054af@o253601.ingest.sentry.io/5499968",integrations:[p.dp()],tracesSampleRate:1,release:`${f.UU}@${f.rE}`}),(0,m.H)(document.getElementById("root")).render((0,d.jsx)(function(){let e;let[t,n]=(0,x.useState)(0),[a,l]=(0,x.useState)(!0),[i,s]=(0,x.useState)();switch(t){case 2:e=nf;break;case 1:e=tY}return(0,d.jsxs)(d.Fragment,{children:[i?(0,d.jsx)(no,{result:i,onStart:()=>l(!0),onClose:()=>s(void 0)},i.id):(0,d.jsx)(tH,{onEncode:()=>{n(1),l(!0)},onCompare:()=>{n(2),l(!0)}}),e&&(0,d.jsx)(e,{isOpen:a,onChange:function(e){l(!1),e.id=(i?.id||1)+1,s(e)},onClose:()=>l(!1)})]})},{}))},7722:(e,t,n)=>{e.exports=n.p+"s/diff.wasm"}},e=>{var t=t=>e(e.s=t);e.O(0,[269],()=>t(3266)),e.O()}]);
//# sourceMappingURL=index.js.map